services:
  connector_nginx:
    build:
      context: .
      dockerfile: ./nginx/Dockerfile

    container_name: connector_nginx
    volumes:
      - /app/backend/production-static:/app/backend/production-static
      - ../true-effects/trueeffectsfrontend/build:/build
      - ../true-effects/certbot/conf:/etc/letsencrypt
      - ../true-effects/certbot/www:/var/www/certbot
    ports:
      - "80:80"
      - "443:443"
    networks:
      - connector
      - certificates

  production_certbot:
    image: certbot/certbot
    container_name: production_certbot
    volumes:
      - ./certbot/conf:/etc/letsencrypt
      - ./certbot/www:/var/www/certbot
#    command: certonly --webroot -w /var/www/certbot --force-renewal --email michal.lejwoda@gmail.com -d true-effects.pl --agree-tos
    command: >
      sh -c "
        certbot certonly --webroot -w /var/www/certbot --force-renewal --email michal.lejwoda@gmail.com -d true-effects.pl --agree-tos &&
        certbot certonly --webroot -w /var/www/certbot --force-renewal --email michal.lejwoda@gmail.com -d language-flashcards.pl --agree-tos
      "
    networks:
      - certificates
networks:
  certificates:
  connector:
    external: true

